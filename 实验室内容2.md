# 回顾
1. J(q) = T~A~(θ)J~A~，v~e~ = T~A~(θ~e~)x~e~'，其中J~A~是分析雅可比，J是几何雅可比。

# 论文
## 视觉伺服
根据控制结构是否分层，视觉系统是否提供设定点给关节级控制器，误差定义在任务空间或图像特征，可对伺服系统进行分类
1. dynamic look-and-move：有分层，有设定点，任务空间


2. dynamic image-based look-and-move：有分层，有设定点，图像特征

3. Position-based visual servo(PBVS)：无设定点，图像特征通过位姿估计，减小位姿估计空间的误差。

4. Image-based visual servo(IBVS)：无设定点，图像特征。

末端执行器相对于物体的位置仅由其与相机的已知运动学关系间接决定。这种运动学关系中的误差会导致了系统无法观察到的定位误差。直接观察末端执行器可以使感知和纠正这类错误成为可能。
将只观察物体的系统称为端点开环系统(EOL)，观察物体和末端执行器的称为端点闭环系统(ECL).

记e' = L~e~v~e~，考虑v~e~为输入，使误差指数下降，得到v~e~ = -λL~e~^+^e，需要考虑s的选择和L~e~^+^的估计。

### PBVS
#### 基于点特征的运动
假设机器人上的点在末端坐标系下表示为^e^P，在固定坐标系下为S，定义误差E~pp~(x~e~;S,^e^P) = T~e~(^e^P) - S，假设在相机坐标系下为^c^S^，位姿估计得到 T~c~^， 有S^ = T~c~^( ^c^S^)，设定比例控制律为u~3~ = -kE~pp~。现在在末端坐标系下类似有^e^E~pp~ = ^e^P - ^e^T~0~(S)，^e^u~3~ = -k^e^E~pp~。
为转化为ECL系统，假设^e^P由摄像机观察并估计，则控制律改写为^e^u~3~ = -k^e^T~c~(^c^P - ^c^S)。（此处省略符号^表示估计得到），又由P' = ΩxP + T = A(P)r' = A(P)u，得到u = A(P)^+^u~3~，^e^u = A(^e^P)^+^^e^u~3~

现在假设^e^P要移动到S~1~,S~2~组成的直线上，描述轨迹的误差函数可以为：E~pl~(x~e~;S~1~,S~2~,^e^P) = (S~2~ - S~1~) X ((T~e~(^e^P) - S~1~) X (S~2~ - S~1~))，类似的有u = -kA(P)E~pl~，一个点在线上限制了两个自由度。现在假设两个点P~1~，P~2~要移动到线上，限制为E~ppl~，则可以表示为平移加上绕轴的旋转。旋转轴K表示为K = ||S~2~ - S~1~|| X ||R~e~(^e^P~2~ - ^e^P~1~)||，旋转部分的控制律为Ω = -k~1~K。结合平移和旋转部分，有T = -k2E~pl~ - Ω X (T~e~(^e^P~1~))

#### 基于位姿的运动
假设^t^S是物体坐标系下任意固定点，^t^T~e~^*^是期望位姿，定义误差E~rp~ = ^e^T~e~^*^ = ^e^T~0~ * T~t~ * ^t^T~e~^*^。如果能观测末端执行器并估计位姿，则有^e^T~e~^*^ = ^e^T~c~^c^T~t~^t^T~e~^*^

## 基于图像的控制
### 图像雅可比矩阵  
P' = Ω X P + T，又归一化坐标[u v] = λ/z[x y]，故：
* x' = zw~y~ - vz/λw~z~ + T~x~
* y' = uz/λw~z~ - zw~x~ + T~y~
* z' = z/λ(vw~x~ - uw~y~) + T~z~

又由商法则得到u' = λ(zx' - xz')/z^2^，可以解得u'和v'，得到雅可比矩阵。

## 图像特征提取
### 基于特征的方法
采用基于窗口的处理技术，记I(x,t)为像素x=[u,v]在时间t时画面中。窗口可看作二维数组。W = I(c + R(θ)x,t)
基于窗口的跟踪算法分为两步，第一步使用窗口参数获取多个窗口，索引像素值被复制到二维数组中被视为矩形图像，第二部对窗口进行处理，定位特征，计算新的窗口参数θ和c，并循环。

边缘线段被像平面的三个参数描述，u和v指段中心相对像平面坐标系的坐标。假设正确的先验值c=(u^-^, v^-^)，θ^-^，可以生成垂直边缘线段的窗口W^-^。
孤立的边缘可以通过计算信号的一阶导数最大值来定位。假设e是1维边缘检测核，卷积W~1~(x) = (W^-^ * e)(x)在每一行都有一个响应曲线，在边缘达到峰值。将W~1~的每一列求和叠加得到一维响应曲线，如果θ^-^正确，最大值即为窗口坐标中边缘的偏移量。对最大值周围的响应曲线进行插值，可以得到亚像素定位。e为1维Prewitt算子。
如果θ^-^不准确，W1中响应曲线彼此会略有偏离，叠加形成较低，不尖锐的聚合曲线，可以最大化聚合响应曲线的最大值。可以通过对在θ^-^处获得的窗口卷积，对包括两个θ^-^+-α包围角度的三个方向进行列求和，对相应聚合相应曲线最大值进行二次插值来近似。可以计算得垂直偏移δo和方向偏移δθ，准确窗口可更新为θ^+^ = θ^-^ + δθ，u^+^ = u^-^ - δosin(θ^+^)，v^+^ = v^-^ + δocos(θ^+^)

### 基于区域的方法
考虑中心位置不同的窗口，假设在t时刻位置c处获得了一些参考窗口，时间间隔┏后，在位置c+d获得了相同大小的窗口。两幅图像的对应关系：O(d) = Σf((W(x;c,t)) - W(x;c+d,t+┏))w(x)。
其中w是图像区域的加权函数，f是标量函数，可采用SAD（f(x) = |x|）或SSD（f(x) = x^2^）。目标是找到使O(d)最小化的位移d。一旦找到离散最小值，可以通过插值到最小值附近的SSD值将该位置细化到亚像素精度。
采用连续优化方法，W(x;c+d,t+┏) = W(x;c,t)+W~x~(x)dx+W~y~(x)dy，其中W~x~(x) = (W * [1 -1;1 -1])(x)，W~y~(x) = (W * [1 1;-1 -1])(x)，W~t~(x) = ((W(;c,t+┏) - W(;c,t)) * [1 1;1 1])(x)。

设g(x) = [W~x~(x) sqrt(w(x));W~y~(x) sqrt(w(x))]，h(x) = W~t~(x)sqrt(w(x))，得到O(d)≈Σ(g(x)*d + h(x)┏)^2^，对d求导，得到[Σ(g(x)g(x)^T^)]d = Σh(x)g(x)，求解可得d。


## 直接自适应阻抗恒力跟踪
当操纵手末端执行器与环境接触，末端执行器坐标空间可分解为位置子空间和力子空间，分别对应末端执行器自由移动和受环境约束的方向。混合位置/力控制方法通过控制位置子空间中的末端执行器位置和力子空间中的相互作用力实现运动。
阻抗控制方法目标是调节机器人末端执行器的机械阻抗保持末端执行器位置与环境接触力之间所期望的动态关系。

### 阻抗控制的力跟踪特性
目标阻抗由接触力误差E = F~r~ - F驱动，F~r~是一个确定的轨迹。假设目标阻抗为二阶线性系统，以使力误差E和位置X模仿质量-弹簧-阻尼系统。
目标阻抗的公式为Md^2^[X(t) - X~r~(t)]/dt^2^ + Bd[X(t) - X~r~(t)]/dt + K[X(t) - X~r~(t)] = E(t)，自由空间里F = F~r~ = 0。该等式是稳定的微分方程，t趋于∞时X - X~r~趋于0。末端执行器可以精确跟踪，当与环境接触时则不准确。

用小写表示，假设x~r~为定值，则mx'' + bx' + k(x - x~r~) = e，又由于x = 1/k~e~ * f + x~e~，则me'' + be' + (k+k~e~)e = mf~r~'' + bf~r~' + kf~r~ - k~e~k(x~r~ - x~e~)
记稳态力跟踪误差e~ss~ = k/k + k~e~[f~r~ + k~e~(x~e~ - x~r~)] = k~eq~[f~r~/k~e~ + x~e~ - x~r~]，k~eq~说目标阻抗和环境的等效刚度。
稳态接触力f~ss~ = f~r~ - e~ss~，当x~r~选择为x~e~ + f~r~/k~e~时e~ss~=0，即如果先验知道环境精确位置和刚度，就可以合成参考轨迹x~r~以施加f~r~，实际上真实值会存在差异Δx~e~，Δk~e~，记x~act~ = x~e~ + Δx~e~，k~act~ = k~e~ + Δk~e~，由于k~e~很大，很小的Δ也会造成很大的误差。

存在一个剩余位置跟踪误差，基于位置的阻抗控制系统如图：

阻抗滤波器根据x~r~和力误差E生成跟踪轨迹x~d~，记ε = x~d~ - x为剩余位置误差，则me'' + be' + (k+k~e~)e = k~e~km~e~ + mf~r~'' + bf~r~' + kf~vr~ + k~e~[mε'' + bε' + k(ε - x~r~)]，记e~ss~ = k~eq~[f~r~/k~e~ + x~e~ + ε - x~r~]。

### 直接自适应控制方案
考虑x~r~(t) = g(t) + k~p~(t)e(t) + k~d~(t)e'(t)，其中e'由于噪声信号无法获取。此处考虑f~r~为常量，则me'' + be' + (k+k~e~)e = k(f~r~+k~e~x~e~) - kk~e~x~r~，代入得：e'' + [b+kk~e~k~d~(t)/m]e' + [k+k~e~+kk~e~k~p~/m]e = k(f~r~ + k~e~x~e~) - kk~e~g(t)/m，此为模型参考自适应控制(MRAC)中的可调系统。
假设力跟踪误差e~m~的期望行为被指定为e~m~'' + 2ζwe~m~' + w^2^e~m~ = 0，该等式构成MRAC框架的参考模型。
让误差动态响应倾向于参考模型的自适应律由比例积分自适应律给出，有g(t) = g(0) + α~1~∫q(t)dt + α~2~q(t)，k~p~(t) = k~p~(0) + β~1~∫q(t)e(t)dt + β~2~q(t)e(t)，k~d~(t) = k~d~(0) + γ~1~∫q(t)e'(t)dt + γ~2~q(t)e'(t)，其中q(t) = w~p~e(t) + w~d~e'(t)。

考虑对力/力矩信号进行滤波，去除高频噪声，区分滤波后的信号。另一种方法是将e'用-k~e~x'替换，对自适应律进行更改，有：
* x~r~(t) = g(t) + k~p~(t)e(t) - k~v~(t)x'(t)
* g(t) = g(0) + α~1~∫q(t)dt + α~2~q(t) - σ~1~∫g(t)dt
* k~p~(t) = k~p~(0) + β~1~∫q(t)e(t)dt + β~2~q(t)e(t) - σ~2~∫k~p~(t)dt
* k~v~(t) = k~v~(0) - λ~1~∫q(t)x'(t)dt - λ~2~q(t)x'(t) - σ~3~∫k~v~(t)dt

（其中λ~1~ = γ~1~k~e~，λ~2~ = γ~2~k~e~。）
流程图如下，其中斜箭头表示实时更新：


### 间接自适应控制方案
该方案在线估计环境参数k~e~，x~e~，并实时计算参考位置x~r~。考虑x~r~ = x~e~^ + 1/k~e~^ * f~r~，同时f^ = k~e~^(x - x~e~^)。记θ~k~ = k~e
~^ - k~e~，θ~x~ = k~x~^ - k~x~，θ = [θ~k~ θ~x~]^T^，有f^ - f = [x -1]θ。目标变为基于预测误差f^ - f，设计调整k~e~^, k~x~^的方案。
考虑f^趋近于f, 代入得f = -k~e~^(x~r~ - x) + f~r~，考虑用模型三消去x~r~ - x项，得到me'' + be' + (k + k^)e = 0。

考虑李雅普诺夫候选函数V = θ^T^┏θ，其中┏是2x2的正定矩阵。若指定θ' = -┏^-1^[x -1](f^ - f)，则V' = -2(f^ - f)^2^是负定的。
完整的控制律为：
* x~r~ = x~e~^ + 1/k~e~^ * f~r~
* k~e~^(t) = k~e~^(0) - γ~1~∫x(f^ - f)dt
* x~e~^(t) = x~e~^(0) + γ~1~∫(f^ - f)/k~e~^ * (xx~e~^ + γ~2~/γ~1~)dt

流程图如下：


### 仿真研究


# 数字图像处理
## 数字图像基础
### 图像取样和量化
**数字图像**：设(x,y)是Z^2^中的整数，f是把灰度值赋给每个坐标对的函数，则f(x,y)就是一幅数字图像。可以用M行，N列的矩阵来表示数字图像。设灰度级数取L = 2^k^，则存储数字图像所需比特数为b = MxNxk

### 空间操作
* 单像素操作：s = T(z)
* 邻域操作：记S~xy~为f中以(x,y)为中心的一个邻域，输出图像g，例如g(x,y) = 1/mnΣf(r,c) (r,c∈S~xy~)称为邻域操作
* 几何空间变换：(x,y) = T{(v,w)}，T为仿射变换矩阵。类型有尺度变换，旋转变换，平移变换，偏移变换

### 图像变换
T(u,v)二维线性变换可表示为T(u,v) = ΣΣf(x,y)r(x,y,u,v)。其中r为正变换核，同时也有反变换。
若r(x,y,u,v) = r1(x,u)r2(y,v)，则变换核可分，若r~1~(x,y) = r~2~(x,y)，则变换核对称。

## 灰度变换与空间滤波
### 基本的灰度变换
1. 图像反转：s = L-1-r
2. 对数变换：s = clog(1+r)
3. 幂律变换：s = cr^y^

**分段线性变换：**
1. 对比度拉伸，扩展图像灰度级范围
2. 灰度级分层，例如将感兴趣范围的灰度变亮，对其它灰度级不变

### 直方图处理
#### 直方图均衡
假设灰度映射s=T(r)，T(r)单增，且∈(0, L-1)。
图像的灰度级可看作区间[0,L-1]内的随机变量，描绘子是概率密度函数（PDF），p~s~(s) = p~r~(r)|dr/ds|。直方图均衡的变换函数s = (L-1)∫~0~^r^p~r~(w)dw，得到p~s~(s) = 1/L-1，是均匀的。
```
img = cv2.imread("image0.jpg", 1)
cv2.imshow("src", img)

# 彩色图像均衡化,需要分解通道 对每一个通道均衡化
(b, g, r) = cv2.split(img)
bH = cv2.equalizeHist(b)
gH = cv2.equalizeHist(g)
rH = cv2.equalizeHist(r)
# 合并每一个通道
result = cv2.merge((bH, gH, rH))
cv2.imshow("dst", result)
```

#### 直方图匹配
产生处理后有特殊直方图的方法
设G(z) = (L-1)∫p~z~(t)dt = s，z = G^-1^(s)，则
1. 由输入图像得到p~r~(r)，并求得s
2. 求得变换函数G(z)
3. 求得反变换函数G^-1^(z)
4. 对每个s执行反映射，则输出图像的PDF等于指定PDF

#### 直方图统计
r关于均值的2阶矩μ~2~(r) = Σ(r~i~ - m)^2^p(r~i~) = 1/MNΣΣ[f(x,y)-m]^2^
假如需要增强暗色区域，可以把局部平均灰度m~s~与全局灰度均值m~G~比较，若m~s~≤k~0~m~G~，其中k~0~为一正常数，则(x,y)处像素为候选点。同样可以用标准差进行比较。

### 空间滤波
空间滤波器由一个邻域和该邻域包围的图像执行的预定义操作组成，滤波产生一个新像素，坐标等于邻域中心坐标。g(x,y) = ΣΣw(s,t)f(x+s,y+t)
#### 平滑空间滤波器
1. 平滑线性滤波器：也称为均值滤波器，用邻域内像素的(加权)平均值代替图像中每个像素的值，降低了图像灰度的尖锐变化。
2. 统计排序滤波器：例如中值滤波器，将灰度的中值代替像素值

#### 锐化空间滤波器
突出灰度的过渡部分。定义一维中的一阶微分df/dx = f(x+1)-f(x)，二阶微分f(x+1) + f(x-1) - 2f(x)，在图像中，采用二阶微分拉普拉斯算子▼^2^f = d^2^f/dx^2^ + d^2^y/dy^2^，g(x,y) = f(x,y)+c[▼^2^f(x,y)]
**非锐化掩蔽**：
1. 模糊原图像
2. 从原图像中减去模糊图像（产生的差值称为模板）
3. 将模板加到原图像上

**一阶微分**：采用梯度▼f = [df/dx df/dy]，向量长度记为M(x,y)≈|gx|+|gy|，对于3x3的区域，可取M(x,y) = |(z7+2z8+z9)-(z1+2z2+z3)|+|(z3+2z6+z9)-(z1+2z4+z7)|

## 频率域滤波
### 基础知识
#### 冲激
连续变量t在t=0处单位冲激为δ(t)，定义为δ(t) = ∞(t = 0)，并满足等式∫δ(t)dt = 1。一个冲激具有如下取样特性：∫f(t)δ(t)dt = f(0)。对离散冲激，有δ(x) = 1(x = 0)，Σδ(x) = 1。
冲激串定义为s(t) = Σδ(t - nΔT)

#### 卷积
记卷积算子f(t)※h(t) = ∫f(x)h(t-x)dx。
卷积定理：两个函数的卷积的傅里叶变换等于两个函数傅里叶变换在频率域的乘积。

#### 取样
连续函数f(t)，用ΔT单位间隔的冲激串取样乘以f(t)，f^(t) = f(t)s(t)，记f^ (t)傅里叶变换后为F^(μ)
取样定理：记H(μ) = ΔT（μ在最大，最小频率间），有F(μ) = H(μ)F^(μ)，H称为低通滤波器

#### 单变量离散傅里叶变换（DFT）
F^(μ) = ∫Σf^(t)δ(t - nΔt)e^-j2Πμt^dt = Σf~n~e^-j2ΠμΔT^，假设在周期μ=0到μ=1/ΔT间取M个等间距样本，则μ=m/MΔT，代入得F~m~，同样可以用F~m~反变换得到f~n~。

### 两个变量的扩展
考虑冲激δ(t,z) = ∞(t,z = 0)其也具有采样特性，二维傅里叶变换F(μ,v) = ∫∫f(t,z)e^-j2Π(μt + vz)^dtdz，二位取样s(t,z) = ΣΣδ(t - mΔT, z - nΔZ)。

#### 二维离散傅里叶变换
F(u,v) = ΣΣf(x,y)e^-j2Π(ux/M + vy/N)，同样可以由反变换得到f(x,y)

1. 空间和频率间隔：Δu = 1/MΔT，Δv = 1/NΔZ
2. 平移和旋转：用指数项乘以f(x,y)使DFT的原点平移到(u~0~,v~0~)，负指数项乘以F(u,v)使f(x,y)原点平移。
3. 周期性
4. 傅里叶谱和相角：幅度|F(u,v)| = [R^2^(u,v) + F^2^(u,v)]^1/2^称为傅里叶谱，θ = arctan[I/R]称为相角
5. 卷积：f(x,y)※h(x,y) = ΣΣf(m,n)h(x-m,y-n)

DFT简单实现：
```
def dft(f):
    M = f.shape[0]
    x, y = np.mgrid[0:M, 0:M]
    base = np.exp(-1j*2*np.pi/M)
    W = base**w

    F = np.dot(W, f)
    return F


#二维离散傅里叶变换
def dft_2d(f):
    #得到输入的行数和列数
    M, N = f.shape[0], f.shape[1]
    
    #初始化两个复数类型数组，用于保存结果
    F, F_x = np.zeros(shape=(M,N), dtype=np.complex128), np.zeros(shape=(M,N), dtype=np.complex128)
    
    #逐行逐列进行两次一维傅里叶变换
    for i in range(M):F_x[i,:] = dft(f[i,:])
    for i in range(N):F[:,i] = dft(F_x[:,i])
    
    return F
```
### 频率域滤波基础
g(x,y) = IDFT([H(u,v)F(u,v)])。填充：f~P~(x,y) = f(x,y)(0≤x≤A-1和0≤y≤B-1)，= 0(A≤x≤P或B≤y≤Q)，通常取P = 2M，Q = 2N
频率域滤波步骤：
1. 给定MxN大小图像f(x,y)，形成大小为PxQ的填充图像f~P~
2. 用(-1)^x+y^乘以f~P~移到其变换中心
3. 计算图像的DFT，得到F
4. 生成一对称滤波函数H(u,v)，形成乘积G
5. 得到处理后的图像g~p~(x,y) = {real[IDFT(G)]}(-1)^x+y^
在左上象限提取MxN区域，得到处理结果g(x,y)

### 低通滤波器
1. 理想低通滤波器(ILPF): H(u,v) = 1(D(u,v)≤D~0~)或0(其它)。D(u,v)使频率域中点与频率矩形中心的距离
```
def idea_low_pass_filter(source, center, radius=5):
    M, N = source.shape[1], source.shape[0]
    u = np.arange(M)
    v = np.arange(N)

    u,v = np.meshgrid(u, v)
    
    D = np.sqrt((u - center[1]//2)**2 + (v - center[0]//2)**2)
    D0 = radius
    kernel = D.copy()

    kernel[D > D0] = 0
    kernel[D <= D0] = 1

    return kernel
```

2. 布特沃斯低通滤波器(BLPF)：H(u,v) = 1/1 + [D(u,v)/D~0~]^2n^，较低的n值接近低通，较高的n值接近高通。
```
def butterworth_low_pass_filter(img, center, radius=5, n=1):
    epsilon = 1e-8
    M, N = img.shape[1], image.shape[0]

    u = np.arange(M)
    v = np.arange(N)

    u,v = np.meshgrid(u, v)

    D = np.sqrt((u - center[1]//2)**2 + (v - center[0]//2)**2)
    D0 = radius
    kernel = (1 / (1 + (D / D0 + epsilon)**(2*n)))
    return kernel
```

3. 高斯低通滤波器：H(u,v) = exp(-D^2^(u,v)/2D~0~^2^)

### 频率域滤波器锐化图像
1. 理想高通滤波器
2. 补特沃斯高通滤波器：H(u,v) = 1/1 + [D~0~/D(u,v)]^2n^
3. 高斯高通滤波器：1 - exp(-D^2^(u,v)/2D~0~^2^)
4. 频率域拉普拉斯算子：H(u,v) = -4Π^2^(u^2^ + v^2^)或H(u,v) = -4Π^2^[(u - P/2)^2^ + (v - Q/2)^2^]，则▽^2^f(x,y) = IDFT{H(u,v)F(u,v)}，增强g(x,y) = f(x,y) + c▽^2^f(x,y)

#### 同态滤波
f(x,y)表示为照射分量i(x,y)和反射分量r(x,y)的乘积，定义z(x,y) = lnf(x,y) = lni + lnr，有DFT{z(x,y)} = DFT{lni(x,y)} + DFT{lnr(x,y)}，或Z(u,v) = F~i~(u,v) + F~r~(u,v)，可以对Z滤波，然后取指数

### 选择性滤波
1. 带阻/带通滤波器：引入带宽W，处理指定频段或频率矩形的小区域。对布特沃斯，有H(u,v) = 1/1 + [DW/D^2^ - D~0~^2^]^2n^，对高斯，有H(u,v) = 1 - exp(-[D^2^ - D~0~^2^/DW]^2^)，带通滤波器H~BP~ = 1- H~BR~

2. 陷波滤波器：在某一个频率点迅速衰减信号，属于带阻滤波器的一种，记为H~NR~(u,v) = ΠH~k~(u,v)H~-k~(u,v)，其中H~k~(u,v)为高通滤波器，中心位于(u~k~, v~k~)。

### 快速傅里叶变换(FFT)
F(u) = Σf(x)W~M~^ux^，其中W~M~ = exp(-j2Π/M)，假设M = 2K，则F(u) = Σ^K-1^f(2x)W~2K~^u(2x)^ + Σ^K-1^f(2x+1)W~2K~^u(2x+1)^ = F~even~(u) + F~odd~(u)W~2K~^u^，F(u+K) = F~even~(u) - F~odd~(u)W~2K~^u^。再递推计算F~even~和F~odd~

C++实现：
```
void FFT(complex<double> *a, int n, int inv){
    if (n==1) return;
    int mid = n / 2;
    complex<double> A1[mid + 1], A2[mid + 1];
    for (int i = 0; i <= n; i += 2){
        //奇数部分给A2，偶数部分给A1
        A1[i / 2] = a[i];
        A2[i / 2] = a[i + 1];
    }
    //递归分治
    FFT(A1, mid, inv)；
    FFT(A2, mid, inv)；
    complex<double> w0(1, 0), wn(cos(2 * pi / n), inv * sin(2 * pi / n));
    for (int i = 0; i < mid; ++i, w0 *= wn){
        a[i] = A1[i] + w0 * A2[i];
        a[i + n / 2] = A1[i] - w0 * A2[i];
    }
}
```
opencv的相关API：
```
# 1.1 正变换
dft = cv.dft(np.float32(img),flags = cv.DFT_COMPLEX_OUTPUT) 
# 1.2 频谱中心化
dft_shift = np.fft.fftshift(dft)
# 1.3 计算频谱和相位谱
mag, angle = cv.cartToPolar(dft_shift[:,:,0], dft_shift[:,:,1], angleInDegrees=True)
mag=20*np.log(mag)
# 2 傅里叶逆变换
# 2.1 反变换
img_back = cv.idft(dft)
# 2.2 计算灰度值
img_back = cv.magnitude(img_back[:,:,0],img_back[:,:,1])
```

## 图像复原与重建
### 图像退化模型
g(x,y) = h(x,y)※f(x,y) + η(x,y)，h(x,y)为退化函数空间表示，η为噪声。等价频率域表示：G(u,v) = H(u,v)F(u,v) + N(u,v)。

### 噪声模型
1. 高斯噪声：p(z) = 1/sqrt(2Π)σ * exp(-(z - z')^2^/2σ^2^)
2. 瑞利噪声：p(z) = 2/b(z - a)exp(-(z - a)^2^/b)(z >= a)
3. 爱尔兰噪声：p(z) = a^b^z^b-1^/(b-1)! * e^-az^
4. 指数噪声：p(z) = ae^-az^
5. 均匀噪声：p(z) = 1/b - a
6. 椒盐噪声：p(z) = P~a~(z = a), P~b~(z = b), 1 - P~a~ - P~b~(其它)

### 只存在噪声的复原
1. 均值滤波器：令S~xy~表示中心在(x,y)处，大小mxn的矩形子图像窗口，算术均值滤波计算被污染图像g(x,y)的均值，在(x,y)处复原。几何均值滤波计算g(x,y)的1/mn次幂，谐波均值滤波器计算mn/Σ(1/g(s,t))
2. 统计排序滤波：中值滤波，最大/最小值滤波，中点滤波
3. 自适应局部滤波器：将均值m~L~和噪声，图像方差σ~η~^2^，σ~L~^2^作为滤波器基础。f(x,y) = g(x,y) - σ~η~^2^/σ~L~^2^[g(x,y) - m~L~]
代码:
```
hImg = img.shape[0]
wImg = img.shape[1]
m, n = 5, 5

# 边缘填充
hPad = int((m - 1) / 2)
wPad = int((n - 1) / 2)
imgPad = np.pad(img.copy(), (hPad, m-hPad-1), (wPad, n-wPad-1), mode='edge')

# 估计图像噪声方差
mean, stddev = cv2.meanStdDev(img)
sigmaEta = stddev ** 2

# 自适应局部降噪
epsilon = 1e-8
imgAdaLocal = np.zeros(img.shape)
for i in range(hImg):
    for j in range(wImg):
        pad = imgPad[i:i+m, j:j+n]
        gxy = img[i,j]
        zSxy = np.mean(pad) # 局部平均灰度
        sigmaSxy = np.var(pad) # 灰度局部方差
        rateSigma = min(sigmaEta / (sigmaSxy + epsilon), 1.0)
        imgAdaLocal[i,j] = gxy - rateSigma * (gxy - zSxy)
```

4. 自适应中值滤波器：考虑符号z~min~, z~max~, z~med~, z~xy~, S~max~，表示S~xy~中的最小，最大灰度值，中值等。
算法：
```
1. 计算A1 = zmed - zmin，A2 = zmed - zmax
2. 若A1 > 0或A2 < 0, 进行下一步,否则增大窗口尺寸
3. B1 = zxy - zmin, B2 = zxy - zmax
4. 若B1 > 0且B2 < 0, 输出zxy,否则输出zmed
```

## 图像分割
考虑前面一阶导数和二阶导数的定义，一阶导数通常产生较粗边缘，二阶导数对精细边缘有较强响应。二阶导数在斜坡，灰度台阶过渡处会产生双边缘响应。二阶导数符号可确定过渡从亮到暗。

### 孤立点的检测
二阶导数计算可使用拉普拉斯算子▽^2^f(x,y) = f(x+1,y)+f(x,y+1)+f(x-1,y)+f(x,y-1)-4f(x,y)，如果某点响应的绝对值超过了某个阈值，则点已被检测到，标注为1，其它标注为0. 拉普拉斯模板[1 1 1, 1 -8 1, 1 1 1]
```
# 用scipy.signal实现卷积
hImg, wImg = imgGray.shape
kernelLaplace = np.array([[1, 1, 1], [1, -8, 1], [1, 1, 1]])
imgLaplace = signal.convolve2d(imgGray, kernelLaplace, boundary='symm', mode='same')

# 在原图用半径为5的圆圈标记点
T = 0.9 * max(imgLaplace.max(), -imgLaplace.min())
imgPoint = np.zeros((hImg, wImg), np.unit8)
for h in range(hImg):
    for w in range(wImg):
        if (imgLaplace[h, w] > T) or (imgLaplace[h, w] < -T):
            imgPoint[h, w] = 255
            cv2.circle(imgPoint, (w, h), 10, 255)
```

### 线检测
不同方向的拉普拉斯算子：[-1 -1 -1, 2 2 2, -1 -1 -1]表示水平，[2 -1 -1, -1 2 -1, -1 -1 2]表示＋45°，[-1 2 -1, -1 2 -1, -1 2 -1]表示垂直。

### 边缘模型
1. 台阶模型，在一个像素距离上发生两灰度级的过渡
2. 斜坡模型，实际中模糊且带有噪声的边缘
3. 屋顶模型

### 边缘检测技术
#### Marr-Hildreth边缘检测器
考虑二维高斯函数G(x,y)=exp(-(x^2^+y^2^)/2σ^2^)，计算▽^2^G(x,y) = [x^2^ + y^2^ - 2σ^2^/σ^4^]exp(-(x^2^+y^2^)/2σ^2^)，该式被称为高斯拉普拉斯(LoG)，模板为[0 0 -1 0 0, 0 -1 -2 -1 0, -1 -2 16 -2 -1, 0 -1 -2 -1 0, 0 0 -1 0 0]。
算法为：
1. 先生成nxn高斯低通滤波器对图像的卷积
2. 计算第一步得到的图像的拉普拉斯
3. 找到零交叉

（也可以先求LoG核再卷积）
n取大于等于6σ的最小奇数，零交叉寻找方法是取p为中心的3x3邻域，将左右，上下，两个对角进行比较，存在符号不同。
```
def ZeroDetect(img):  # 判断零交叉点
    h, w = img.shape[0], img.shape[1]
    zeroCrossing = np.zeros_like(img, np.uint8)
    for x in range(0, w-1):
        for y in range(0, h-1):
            if img[y][x] < 0:
                if (img[y][x-1] > 0) or (img[y][x+1] > 0)\
                or (img[y-1][x] > 0) or (img[y+1][x] > 0):
                    zeroCrossing[y][x] = 255
    return zeroCrossing

# 由 Gauss 标准差计算 Marr-Hildreth 卷积核
sigma = 3  # Gauss 标准差，输入参数
size = int(2 * round(3 * sigma)) + 1  # 根据标准差确定窗口大小，3*sigma 占比 99.7%
print("sigma={:d}, size={}".format(sigma, size))
x, y = np.meshgrid(np.arange(-size/2+1, size/2+1), np.arange(-size/2+1, size/2+1))  # 生成网格
norm2 = np.power(x, 2) + np.power(y, 2)
sigma2, sigma4 = np.power(sigma, 2), np.power(sigma, 4)
kernelLoG = ((norm2 - (2.0 * sigma2)) / sigma4) * np.exp(- norm2 / (2.0 * sigma2))  # 计算 LoG 卷积核
# Marr-Hildreth 卷积运算
imgLoG = signal.convolve2d(imgBlur, kernelLoG, boundary='symm', mode='same')  # 卷积计算
# 判断零交叉点
zeroCrossing = ZeroDetect(imgLoG)
```

#### canny检测器
用高斯滤波对图像卷积，并得到梯度幅度M(x,y)，角度α(x,y)，对梯度幅值进行非极大值抑制(NMS)：寻找最接近α(x,y)方向d~k~，如果M(x,y)的值至少小于沿d~k~的两个邻居之一，令g~N~(x,y)=0，否则令g~N~(x,y)=M(x,y)。
最后用双阈值处理和连通性分析检测和连接边缘：TH>TL，大于TH为强边缘，两者之间为弱边缘





# 力控制
分为间接力控制和直接力控制，区别在于前者通过运动控制完成力控制，无需力反馈回路。
## 柔量控制
有模型B(q)q'' + C(q,q')q' + Fq' +g(q) = u - J^T^(q)h~e~，其中h~e~为机械手末端执行器施加于环境的接触力向量。平衡状态下，J~A~^T^(q)K~P~x^ = J^T^(q)h~e~，则x^ = K~P~^-1^T^T^~A~(x~e~)h~e~ = K~P~^-1^h~A~，h~A~为等效力向量，则h~A~ = K~P~x^，K~P~为等效力的刚度矩阵

假设两刚体R，S以弹簧相连和两坐标系，s上的点相对r的元位移为dx~r,s~ = [dO~r,s~ w~r,s~dt] = v~r,s~dt，S受弹性力h~s~ = [f~s~ μ~s~] = [K~f~ K~c~, K~c~^T^ K~μ~]dx~r,s~，K~f~, K~μ~为平移，旋转刚度，K~c~为耦合刚度。

### 主动柔量
根据PD控制表达式u = g(q)+J~A~^T^(q,x^) (K~P~x^ - K~D~J~A~(q,x^)q')，由平衡状态的等式得h~e~ = T~A~^-1^K~P~x^ ，元位移形式dx^ = T~A~^-1^K~P~dx~e,d~，得h~e~ = K~P~dx~e,d~。又h~e~ = Kdx~r,e~，dx~r,e~ = dx~r,d~ - dx~e,d~，得到h~e~ = (I + KK~P~^-1^)^-1^Kdx~r,d~，代入得：
* dx~e,d~ = K~P~^-1^(I + KK~P~^-1^)^-1^Kdx~r,d~，表示末端执行器的位置误差

又K~P~q^ = J^T^(q)h~e~，dx^ ≈ J(q)dq^ ，得到dx^ = J(q)K~P~^-1^J^T^(q)h~e~。

## 阻抗控制
控制律u = B(q)y + n(q,q')，存在末端执行器受力时，q'' = y - B^-1^(q)J^T^(q)h，选择y = J~A~^-1^(q)M~d~^-1^(M~d~x~d~'' + K~D~x'^ + K~P~x^ - M~d~J'~A~(q,q')q')，代入得:
* M~d~x''^ + K~D~x'^ + K~P~x^ = M~d~B~A~^-1^(q)h~A~，其中B~A~(q) = J~A~^-T^(q)B(q)J~A~^-1^(q)，M~d~为质量矩阵，K~d~为阻尼矩阵。

B~A~^-1^使系统耦合，若希望解耦需测量接触力，通过力传感器实现。选择u = B(q)y + n(q,q') + J^T^(q)h，y = J~A~^-1^(q)M~d~^-1^(M~d~x~d~'' + K~D~x'^ + K~P~x^ - M~d~J'~A~(q,q')q' - h~A~)，则
* M~d~x^'' + K~D~q^' + K~P~x^ = h~A~

同时也有取y = J~A~^-1^(q)M~d~^-1^(K~D~x'^ + K~P~x^ - M~d~J'~A~(q,q') + M~d~b' - h~e~)，得
* M~d~x^'' + K~D~x^' + K~P~x^ = h~e~，它与机械手位形无关



## 直接力控制
力控制可以采用外力调节反馈回路向机械手运动控制方案提供控制输入。假设环境弹性模型f~e~ = K(x~e~ - x~r~)
### 包含内位置回路的力控制
选择控制y = J^-1^(q)M~d~^-1^(-K~D~x'~e~ + K~P~(x~F~ - x~e~) - M~d~J'(q,q')q')，x~F~是与力误差有关的参考量。可以得到M~d~x~e~'' + K~D~x~e~' + K~P~x~e~ = K~P~x~F~，其中x~F~ = C~F~(f~d~ - f~e~)，代入得：
* M~d~x~e~'' + K~D~x~e~' + K~P~(I + C~F~K)x~e~ = K~P~C~F~(Kx~r~ + f~d~)

选取C~F~为比例积分作用K~F~ + K~I~∫dδ，结构图如下：


### 包含内速度回路的力控制
选择y = J^-1^(q)M~d~^-1^(-K~D~x'~e~ + K~P~x~F~ - M~d~J'(q,q')q')，取C~F~ = K~F~，有M~d~x~e~'' + K~D~x~e~' + K~P~K~F~Kx~e~ = K~P~K~F~(Kx~r~ + f~r~)
控制结构图如下：

### 并联力/位置控制
选择y = J^-1^(q)M~d~^-1^(K~D~x'~e~ + K~P~(x~F~ + x^) - M~d~J~A~'(q,q')q')，由于存在与力控并联的位置控制K~P~x^，平衡位置满足x~e~ = x~d~ + C~F~(K(x~r~ - x~e~) + f~d~)
结构图如下：


## 约束运动
考虑以下两种简化假设：
1. 机器人和环境完全刚性，由环境施加纯运动学约束。
2. 机器人是完全刚性的，所有柔性局限于环境中，接触力和力矩由线性弹性模型近似
### 刚性环境
环境造成的运动学约束用一组代数方程表示ρ(q) = 0，计算时间导数，有J~ρ~(q)q' = 0，J~ρ~称为约束雅可比矩阵。假设在操作点的极小邻域内J~ρ~秩为m，等价于m个约束方程局部独立。

在末端执行器违反约束时，相互作用力以反作用力出现，在关节上产生反力矩。考虑虚功表达式δW~┏~ = ┏^T^δq，┏ = J^T^(q)y~e~，其中y~e~是末端执行器力。虚位移满足J~ρ~(q)δq = 0，可得┏ = J^T^~ρ~(q)λ，相应地施加于末端执行器的力h~e~ = J^-T^(q)┏ = S~f~(q)λ

λ = S^+^~f~(q)h~e~，S^+^表示加权广义逆矩阵(S^T^WS)S^T^W。由于约束方程不唯一，故S~f~不唯一，且λ元素的物理维数并不相同，因此S~f~和S^+^~f~的列不一定表示相同维数。含广义逆矩阵变换的式通常会取决于参考坐标系，为保证不变性，选取S~f~使其列表示线性独立的力，h~e~为力的线性组合。若C为正定柔量矩阵，选权值矩阵W=C。 由J~ρ~(q)q' = J~ρ~(q)J^-1^(q)J(q)q' = S~f~v~e~ = 0，得到等价于h~e~^T^v~e~ = 0，两者有互易性。

S~f~维度为mx6(被控力子空间维数m)，定义6x(6-m)维矩阵S~v~，使S~f~^T^(q)S~v~(q) = 0，所以类似有v~e~ = S~v~(q)v

### 柔性环境
一般情况下，末端执行器部分受环境约束，引入适当的半正定刚度矩阵进行建模
h~e~ = S~f~λ，环境形变dx~r,s~ = Ch~e~。又末端执行器元位移可分解为dx~r,e~ = dx~v~ + dx~f~，其中dx~v~ = P~v~dx~r,e~，dx~f~ = (I - P~v~)dx~r,s~，得到S~f~^T^dx~r,e~ = S~f~^T^dx~r,s~ = S~f~^T^CS~f~λ，得到h~e~ = K'dx~r,e~，其中K' = S~f~(S~f~^T^CS~f~)^-1^S~f~^T^，同理dx~f~ = C'h~e~，C' = (I - P~v~)C

* 注：P~v~ = S~v~S^+^~v~为投影矩阵，将v~e~投影到速度子空间R(S~v~)上

### 自然/人为约束
* 自然约束：速度约束指不能沿轴方向平移或绕轴旋转，力约束指不能沿轴施加力，或绕轴运用力矩。
* 人工约束：机械手只能控制不服从自然约束的变量，变量的参考值为人工约束

例如，末端执行器在桌面上滑动一物体。由于不可能产生z轴线速度，可取自然约束o'~z~，相应对z轴的力施加人工约束f~z~，有自然约束[o'~z~ w~x~ w~y~ f~x~ f~y~ μ~z~]，人为约束[f~z~ μ~x~ μ~y~ o'~x~ o'~y~ w~z~]，根据人为约束选取S~f~和S~v~

## 混合力/力矩控制
控制作用应不影响受环境约束的变量，避免控制与环境的相互作用的冲突，其可能导致不适当的系统相应。人工约束定义中包含了力和位置或速度变量。

考虑v~e~' = J(q)q'' + J'(q)q'和q'' = -B^-1^(q)C(q,q')q' - B^-1^(q)g(q) + B^-1^(q)J^T^(q)(y~e~ - h~e~)，得到B~e~(q)v~e~' + n~e~(q,q') = y~e~ - h~e~，其中B~e~ = J^-T^BJ^-1^，n~e~ = J^-T^(Cq' + g) - B~e~J'q'
(注意区分h是环境接触引起末端执行器力，y是关节作用在末端执行器的力)

### 柔性环境
考虑dx~r,e~ = P~v~dx~r,e~ + C'S~f~λ，末端执行器速度分解为v~e~ = S~v~v + C'S~f~λ'，其中第一项为速度控制子空间，第二项为其正交补空间。v~e~' = S~v~v' + C'S~f~λ''，采用逆动力学控制律y~e~ = B~e~(q)α + n~e~(q,q') + h~e~，其中α为控制输入，闭环方程v~e~' = α。选取α = S~v~v' + C'S~f~λ''，任务可分配为以λ~d~(t)的形式指定期望力，以v~d~(t)的形式指定期望速度，v~d~由PI控制，λ~d~由PD控制。

控制方框图如下：

由于力的测量会包含噪声，采用h~e~'可用λ' = S~f~^+^K'J(q)q'代替。

### 刚性环境
刚性环境下h~e~ = λS~f~，从而得到v~e~，结合时间导数式子，可消去λ，其中λ = B~f~(q)(S~f~^T^B~e~^-1^(q)(y~e~ - n~e~(q,q')) + S~f~'^T^v~e~)，其中B~f~ = (S~f~^T^B~e~^-1^S~f~)^-1^，因此动力学模型改写为：
B~e~(q)v~e~' + S~f~B~f~(q)S~f~'^T^v~e~ = P(q)(y~e~ - n~e~(q,q'))，其中P = I - S~f~B~f~S~f~^T^B~e~^-1^

根据v~e~' = S~v~v' + S~v~'v和S~v~^T^P = S~v~^T^得到B~v~(q)v' = S~v~^T^(y~e~ - n~e~(q,q') - B~e~(q)S~v~'v)，其中B~v~ = S~v~B~e~S~v~
从而，选择控制y~e~ = B~e~(q)S~v~α~v~ + S~f~f~λ~ + n~e~(q,q') + B~e~(q)S~v~'v，其中控制输入α~v~ = v'，λ = f~λ~。

# 控制理论
## 控制理论基础
### 状态空间方程
对于弹簧质量阻尼系统，由md^2^x(t)/dt^2^ + bdx(t)/dt + kx(t) = f(t)，令输入等于外力，即y(t) = f(t)，输出等于位移，即u(t) = x(t)，对两边拉普拉斯变换得到二阶系统。为变为一阶系统，考虑z~1~(t) = x(t)，z~2~(t) = dx(t)/dt，则dz~2~(t)/dt = 1/m* u(t) - b/mz~2~(t) - k/m*z~1~(t)，可以写成矩阵的表达形式，即
* dz(t)/dt = Az(t) + Bu(t)
* u(t) = Cz(t) + Dy(t)，其中z是状态变量，u是输出，y是输入。

此处令u为输入，y为输出和书中一致：
对两边拉普拉斯变换，得到L(dz(t)/dt) = L[Az(t) + Bu(t)]，L[y(t)] = L[Cz(t) + Du(t)],得到sZ(s) = AZ(s) + BU(s)，Y(s) = CZ(s) + DU(s)，调整后得到传递函数G(s) = Y(s)/U(s) = C(sI - A)^-1^B + D

#### 相平面
令横轴为状态变量z(t)，纵轴为dz(t)/dt，当状态变量dz(t) = 0时，说明z(t)不随时间改变，为**平衡点**。当z(t)偏离平衡点时，随t变化z(t)变化，会自动回到平衡点z~f1~，称为稳定平衡点。

对于二维相平面，考虑形式dz(t)/dt = Az，令z(t) = Pz'(t)，其中P为过渡矩阵[v~1~, v~2~]，其为A的特征向量。有d/dt[dz'~1~(t) z'~2~(t)] = [λ~1~ 0, 0 λ~2~]z'(t)，λ为特征值。 该线性变化不会改变平衡点性质。
若A的特征值是共轭复数，解出来z(t)可能含三角函数，z~1~-z~2~图可能是椭圆，此时平衡点为中心点。考虑z(t)-t图像，若振幅不断加大，则有不稳定焦点，反之为稳定焦点。

### 一阶系统时域响应分析
以牛顿冷却定律dT(t)/dt = -K(T(t) - C(t))为例，dx(t)/dt + Kx(t) = Ku(t)，进行拉普拉斯变换得到G(s) = X(s)/1/Kx(0) + U(s) = K/s + K，定义冲激输入U~1~(s) = 1/Kx(0)，阶跃输入U~2~(s) = U(s)，则G(s) = X(s)/U~1~(s) + U~2~(s)，同时对应冲激相应和阶跃相应。

1. 单位冲激响应
设输入为单位冲激函数，则U(s) = 1，X(s) = U(s)G(s) = a/s + a，则x(t) = ae^-at^，其发散或收敛和a的大小有关。
2. 单位阶跃响应
单位阶跃函数U(s) = 1/s，X(s) = a/s(s + a)，进行拉普拉斯逆变换得到1 - e^-at^。

一阶系统性能指标：
1. 时间常数：ε = 1/a，越小表示系统反应速度越快
2. 稳定时间，T~s~ = 4ε，表示施加阶跃输入后需要T~s~达到稳定状态。

### 二阶系统一般形式
以弹簧质量阻尼系统md^2^x(t)/dt^2^ + bdx(t)/dt + kx(t) = f(t)为例，定义固有频率w~n~ = sqrt(k/m)，阻尼比ζ = b/2sqrt(km)，则d^2^x(t)/dt^2^ + 2ζw~n~dx(t)/dt + w~n~^2^x(t) = w~n~^2^u(t)，得到G(s) = w~n~^2^/s^2^ + 2ζw~n~s + w~n~^2^。

#### 对初始状态的响应
可以得到状态矩阵A = [0 1, -w~n~^2^ -2ζw~n~-λ]求解特征值得到λ~1~，λ~2~。当ζ>=1，称为过阻尼系统，特征值小于0，平衡点为稳定点，ζ=1为临界阻尼系统，收敛更快。ζ<1为欠阻尼系统，平衡点是稳定的焦点。

#### 二阶系统阶跃响应
令传递函数分母为0，考虑多出来一个极点s = 0，X(s) = A/(s - s~1~) + B/(s - s~2~) + C/(s - s~3~)，通分并代入s~1~ = 0，可以解得A，B，C。
* A = 1
* B = -1/2(1 - ζ/sqrt(1 - ζ^2^)j)
* C = -B

带回X(t)，进行拉普拉斯逆变换可得x(t)，记w~d~ = w~n~sqrt(1 - ζ^2^)为阻尼固有频率，θ = arctan(sqrt(1 - ζ^2^)/ζ)，可得x(t) = 1 - e^-ζwnt^sqrt(1/1 - ζ^2^)sin(w~d~t + θ)

#### 二阶系统性能指标
1. 上升时间T~r~ = Π - θ/w~d~，指第一次到稳定点的时间
2. 最大超调量M~p~ = x~max~ - x(∞)/x(∞) * 100％
3. 稳定时间T~s~ = 4/ζw~n~，指系统进入误差2％范围内时间。

### 系统稳定性
考虑无输入状态空间方程dz(t)/dt = f(z(t))
1. 李雅普诺夫稳定性：z~f~满足∀t~0~, ε > 0，∃δ(t~0~, ε)使得||z(t~0~)||＜δ(t~0~, ε)时对∀t >= t~0~，||z(t)|| ＜ ε成立
2. 渐进稳定性：lim||z(t)|| = z~f~ = 0

#### 稳定性与传递函数
分析系统的单位冲激响应判断稳定性，此时输出X(s) = G(s) = (s - s~z1~)(s - s~z2~)...(s - s~zm~)/((s - s~p1~)...(s - s~pq~))((s - σ~1~ + jw~1~)...(s - σ~r~ + jw~r~))，该式说明传递函数包含m个零点，q个实数根极点，r对复数根极点。进行拉普拉斯逆变换得到：x(t) = ΣA~i~e^spit^ + ΣB~k~e^σkt^sin(w~k~t + θ~k~)
极点的实数部分决定系统输出的稳定性：
* s~pi~和σ~k~均＜0时，x(t)随时间增加不断衰减趋于0，渐进稳定
* 如果有一个以上＞0，则不稳定
* 如果存在等于0，则符合李雅普诺夫稳定。

当极点均在复平面左半部分时，能保证稳定。

#### 稳定性与状态空间方程
考虑dz(t)/dt = Az(t)，如果A的特征值实部都不大于0，则满足李亚普诺夫稳定，若都小于0，则满足渐进稳定性。

### 控制器设计
#### 比例控制器
考虑体重变化与热量输入模型7000dm/dt + 10am = E~i~ - E~a~ - a(6.25h - 5α + S)，设a(6.25h - 5α + S) = aC = d(t)代表扰动量，则7000dx(t)/dt + 10ax(t) = u(t) + d(t)，拉普拉斯变换得G(s) = 1/7000s + 10a。引入参考值r(t)，设为常数r，拉普拉斯变换R(s) = r/s，定义误差为E(s) = R(s) - X(s)，比例控制令系统的控制量与误差成正比，即u(t) = K~P~e(t)，U(t) = K~P~E(t)。
得到X(s) = U(s) + D(s) + 7000x~0~/7000s + 10a = E(s)K~P~ + D(s) + 7000x~0~/7000s + 10a，解得X(s) = K~P~R(s) + D(s) + 7000x~0~/7000s + 10a + K~P~，再代入R(s)和D(s)代入，逆变换解得x(t)
**稳态误差**e~ss~ = e(∞) = r - x(∞)，仅利用比例控制器，由于K~P~在分母不可能无限大，故无法消除稳态误差。

#### 比例积分控制器
**终值定理**：若limx(t)存在，则lim~t->∞~x(t) = lim~s->0~sX(s)

考虑零初始，不含扰动的一阶系统，控制C(s)。X(s) = U(s)a/a + s = E(s)C(s)a/a+s = (R(s) - X(s))C(s)a/s+a，解得X(s) = arK~P~/s(s+a+aK~P~)，利用终值定理，解得e~ss~ = r/1 + lim~s->0~C(s)，即要求lim~s->0~C(s) = ∞，因此可令C(s) = K~I~/s，对应U(s) = K~I~/s * E(s)。
代入得到(s^2^ + as + aK~I~)X(s) = aK~I~r/s，逆变换得d^2^x(t)/dt^2^ + adx(t)/dt + aK~I~x(t) = aK~I~r，类比弹簧阻尼系统，得到阻尼比ζ = a/2sqrt(aK~I~)，固有频率w~n~ = sqrt(aK~I~)，从而解得T~r~和M~p~，T~r~随K~I~增加而下降，M~p~随K~I~增加而上升。

比例积分控制C(s) = K~P~ + K~I~/s

#### 含有限制条件的控制器
在流程中加入饱和函数，限制U(s)的幅度，定义为u(t) = u~max~(u(t)>u~max~), u(t), u~min~(u(t)<u~min~)

### 根轨迹
#### 基本规则
G(s) = N(s)/D(s) = (s - s~z1~)(s - s~z2~)...(s - s~zm~)/(s - s~p1~)(s - s~p2~)...(s - s~pn~)
* 如果n＞m，根轨迹在复平面上有n条分支，否则有m条分支
* n = m时，随着K从0到∞，根轨迹从开环传递函数G(s)极点向零点移动。
* 根轨迹位于从右向左奇数个极点/零点左边
* 根轨迹一定关于实轴对称
* 根轨迹沿渐近线移动，渐近线与实轴交点σ = Σs~pn~ - Σs~zm~/n - m，夹角为θ = 2q+1/n-m。

matlab中绘制根轨迹：```rlocus(g)```

#### 几何性质
当s=σ+jw时，传递函数的模M为：Π零点到s距离/Π极点到s距离，复角为θ = Σ零点到s夹角 - Σ极点到s夹角

#### 基于根轨迹的控制器设计
二阶系统转化为单位反馈闭环控制系统：考虑G~cl~(s) = 2Kw~n~s/s^2^ + 2Kw~n~s + w~n~^2^，其中ζ = K，将闭环传递函数通式G~cl~(s) = KG(s)/1 + KG(s)代入，得到G(s) = 2w~n~s/s^2^ + w~n~^2^，转化为了闭环系统。

考虑比例微分控制，G(s) = 1/(s+1)(s+3)，当K=0.5时，通过1+KG(s) = 0，解得实数根s~1~和s~2~，加上拉普拉斯变换R(s) = 1/s，得到输出x(t)为1+C~1~e^-1.29t^+C~2~e^-2.71t^，由于|s~1~|<|s~2~|，故收敛速度由C~1~e^-1.29t^决定，称为主导极点，更靠近虚轴。当K=2时，s = -2+-j，由于收敛速度仅与实部有关，故最快沿着e^-2t^渐近线收敛。若改变系统响应速度，可以改变根轨迹，通过串联控制器/补偿器实现。

考虑s = -3+2sqrt(3)j，由于∠G = -7/6Π，故还需增加1/6Π，考虑增加一个零点-9，即对应传毒函数C(s) = s + 9，U(s) = E(s)KC(s) = K(sE(s) + 9E(s))，得u(t) = K(de(t)/dt + 9e(t))，描述了比例微分控制器。

#### 超前补偿器
PD控制器需要额外能量来源，同时会放大噪声，可引入超前补偿器C(s) = s - s~zc~/s - s~pc~，s~pc~<s~zc~<0，思路是同时增加一个极点和零点。

#### 滞后补偿器
E(s) = R(s) - X(s) = R(s) - E(s)C(s)KG(s)，得E(s) = R(s)/1 + C(s)KG(s)，将C(s) = s - s~zc~/s - s~pc~和G(s) = N(s)/D(s)代入，得到E(s)，进而终值定理求得e~ss~ = D(0)/(D(0) + KN(0)s~zc~/s~pc~)，说明s~zc~/s~pc~越大，e~ss~越小，与超前补偿器相反。

### 控制器设计深入
以指尖平衡为例，在长度为d的连杆顶端固定一质量m的小球，另一端与手指接触，连杆与垂直方向夹角θ(t)，手指对杆作用力F并沿杆，使小球与垂直方向角度θ(t)沿目标轨迹θ~d~(t)移动。

x~2~-x~1~坐标系，x~1~(t) = ζ(t) + dsinθ(t) = ζ(t) + dθ(t)，其中ζ为手指位移。取时间二次微分，得到d^2^x~1~(t)/dt^2^ = d^2^ζ(t)/dt^2^ + d * d^2^θ(t)/dt^2^，从而md~2~ζ(t)/dt^2^ + md * d^2^θ(t)/dt^2^ = Fθ(t)。
同理在x~2~方向用牛顿第二定律，得到Fcosθ(t) - mg = md^2^x~2~(t)/dt^2^，θ很小时x~2~=0，得F = mg。代入得d^2^θ(t)/dt^2^ - g/dθ(t) = -1/d*d^2^ζ(t)/dt^2^。定义输入u(t)=-1/d * d^2^ζ(t)/dt^2^，输出y(t) = θ(t)。

对状态空间建模，选取状态变量z~1~(t) = θ(t)，z~2~(t) = dθ(t)/dt，则有dz(t)/dt = Az(t) + Bu(t)，A = [0 1, g/d 0]，B = [0 1]，同时y(t) = Cz(t) + Du(t)，C=[1 0]，D=[0]。系统框图如下：


#### 能控性
* 状态能控性定义：若存在u(t)，可在有限时间区间[t~0~ t~1~]内将系统状态变量从初始状态z(t~0~)转移到终端状态z(t~1~)，就称z(t~0~)是能控状态。如果在任意t~0~下初始状态均能控，则系统状态能控。
* 判据：对n维线性时不变系统，C~o~ = [B AB A^2^B ... A^n-1^B]的秩为n则能控。

#### 线性状态反馈控制器
令输入u(t) = -Kz(t)，此时u(t)与所有状态变量有关。代入得dz(t)/dt = (A - BK)z(t) = A~cl~z(t)，A~cl~ = A - BK，称为闭环控制系统的状态矩阵。求其特征值，令特征值＜0，解得k~1~，k~2~，得到u(t)

#### LQR控制器
为了更好的选择特征值，引入**代价函数**J = ∫z^T^QZ(t) + u^T^(t)Ru(t)dt，Q，R为权重矩阵，是正定对称阵，一般为对角阵。对该例子，J=∫q~1~z~1~^2^(t) + q~2~z~2~^2^(t) + ru^2^(t)dt，求解J的最小值得出K。

#### 轨迹追踪
令e(t) = z~d~ - z(t)，设计目的为令e(t)平衡点为[0 0]，de(t)/dt = -Az(t) - Bu(t) = -A(z~d~ - e(t)) - Bu(t) = Ae(t) - Az~d~ - Bu(t)，展开得到de~1~(t)/dt = e~2~(t) - z~2d~，de~2~(t)/dt = g/d * e~1~(t) - g/d * z~1d~ - u(t)，z~2d~=0时e~2f~才为0，但e~1f~的平衡点位置随着输入u(t)改变。
可以令u(t) = Fz~d~ + K~e~e(t)，Fz~d~称为前馈，取F = [-g/d 0]，代入得de(t)/dt = [0 1, g/d-k~e1~ -k~e2~][e~1~(t) e~2~(t)]，此时平衡点变为[0 0]^T^，接下来用LQR确定设计K~e~。

带前馈的线性状态反馈控制器如图：


### 观测器设计
* 能观测性定义：对于任意输入u(t)，根据有限时间区间[t~0~, t~1~]的输入和输出值y(t)，可唯一确定t~0~下的初始状态z(t~0~)，则系统在t~0~时可观测。对任意t~0~下z(t~0~)都能观测，则系统状态能观测。
* 判据：O = [C CA CA^2^...CA^n-1^]^T^的秩为n。

#### 线性观测器
考虑
* dz^(t)/dt = Az^(t) + Bu(t) + L(y(t) - y^(t))
* y^(t) = Cz^(t) + Du(t)

2代入1得dz^(t)/dt = (A - LC)z^(t) + (B - LD)u(t) + Ly(t)，该式称为龙伯格观测器，可以通过设计观测矩阵L使z^(t)随t趋近于z(t)。用dz(t)/dt = Az(t) + Bu(t)减去该式，并记z~e~(t)为观测误差，有dz~e~(t)/dt = (A - LC)z~e~(t)，可以找到合适的L使(A - LC)特征值为负数。

线性观测器设计框图：


#### 观测器与控制器结合
令系统输入u(t) = -Kz^(t)，dz(t)/dt = Az(t) - BKz^(t) = (A - BK)z(t) + BKz~e~(t)，可分别选取(A-LC)和(A-BK)得特征值，注意观测器的收敛速度需要比控制器快。

## 现代控制理论
考虑系统x' = Ax + Bu, y = Cx + Du，将原状态矢量x线性变换，得到x = Tz，故z' = T^-1^ATz + T^-1^Bu，y = CTz + Du。非奇异变换不改变系统矩阵A的特征值。
### 基础
#### 状态变量及空间表达式
n阶线性常系数微分方程的通式：y^n^ + a~n-1~y^n-1^ + ... + a~0~y = b~m~u^m^ + b~m-1~u^m-1^ + ... + b~0~u。只要原系统传递函数中分子，分母没有公因子，即不出现零极点对消，则n阶系统必有n个独立状态变量，必有n个一阶微分方程。

1. 传递函数中没有零点时
微分方程为：y^n^ + ... + a~0~y = b~0~u(t)，可以设输出方程y = b~0~x~1~，x~1~' = x~2~，x~2~' = x3... x~n~' = -a~0~x~1~ - a~1~x~2~ - ... - a~n-1~x~n~ + u，从而可以写出x' = Ax + bu

2. 传递函数中有零点
考虑n=m的三阶情况，传递函数W(s) = b~3~s^3^ + b~2~s^2^ + b~1~s + b~0~/s^3^ + a~2~s^2^ + a~1~s + a~0~ = b~3~ + [(b~2~ - a~2~b~3~)s^2^ + (b~1~ - a~1~b~3~)s + (b~0~ - a~0~b~3~)]/s^3^ + a~2~s^2^ + a~1~s + a~0~。
则Y(s) = b~3~U(s) + Y~1~(s)[(b~2~ - a~2~b~3~)s^2^ + (b~1~ - a~1~b~3~)s + (b~0~ - a~0~b~3~)]，求拉式反变换，取x~1~ = y~1~，x~2~ = x~1~', x~3~ = x~2~'，对n阶同理

### 状态空间表达式的解
对于x' = Ax，若x(0) = x~0~，则x(t) = exp(At)x~0~，记exp(At)为状态转移矩阵。
#### 几个特殊矩阵的指数函数
1. A为对角阵
exp(At) = 对角阵[e~λ1t~ e~λ2t~ ... e~λnt~]
2. A能通过非奇异变换对角化：T^-1^AT = B
exp(At) = T[对角阵]T^-1^
3. A为约旦矩阵

#### 线性定常系统的解
状态方程为非齐次矩阵微分方程x' = Ax + Bu，解为x(t) = Θ(t-t~0~)x(t~0~) + ∫Θ(t-r)Bu(r)dr。

#### 线性时变系统的解
考虑标量时变系统dx(t)/dt = a(t)x(t)，即dx(t)/x(t) = a(t)dt，积分得lnx(t) - lnx(t~0~) = ∫a(r)dr，得x(t) = exp(∫a(r)dr)x(t~0~)，此为二元状态转移矩阵。对于矢量方程，需要满足A(t)和∫A(r)dr可交换。

线性时变系统的解为：x(t) = Θ(t,t~0~)x(t~0~) + ∫Θ(t,r)B(r)u(r)dr，其中对于不满足可交换的系统，采用级数近似法计算Θ，即Θ = I + ∫A(r~0~)dr~0~ + ∫A(r~0~)∫A(r~1~)dr~1~dr~0~ + ...

#### 离散时间系统状态方程的解
1. 递推法：x(1) = Gx(0) + Hu(0)，x(2) = Gx(1) + Hu(1)...
2. Z变换法：Θ(k) = G^k^ = Z^-1^[(zI - G)^-1^z]

离散化方法：即将t变为kT，状态空间表达式为：x(k+1) = G(T)x(k) + H(T)u(k)，y(k) = Cx(k) + Du(k)，得到G(T) = e^AT^，H(T) = ∫e^AT^dt*B

### 李亚普诺夫方法
#### 李雅普诺夫第二法
定义二次型标量函数V(x) = x^T^Px，若P为实对称阵，则必存在正交矩阵T，通过x = Tx^-^, 得到V(x) = x^-^^T^P^-^x^-^ = x^-^^T^[λ1 λ2...]x^-^。V(x)正定的充要条件是P的所有特征值均大于0，后者可用sylvester判据判定。

设线性连续定常系统x' = Ax，则平衡状态为渐进稳定的充要条件是A的特征根均有负实部。对任意给定的正定实对称阵Q，若存在给定实对称阵P，满足李雅普诺夫方程A^T^P + PA = -Q，则可取V(x) = x^T^Px，此时V'(x) = x^T^Px' + x'^T^Px = x^T^PAx + (Ax)^T^Px = x^T^(PA + A^T^P)x = -x^T^Qx。

#### 李雅普诺夫方法在非线性系统中的运用
1. 雅可比矩阵法
设x' = f(x)，J(x)为f(x)的雅可比矩阵，则系统在原点渐进稳定的充分条件是任给定正定实对称阵P，有Q = -[J^T^(x)P + PJ(x)]正定，且V(x) = f^T^(x)Pf(x)

2. 变量梯度法
V'(x) = (▽V)^T^x'，先假定▽V为某一形式，根据V'为负定确定待定系数，再由▽求得V(x): V(x) = ∫(▽V)^T^dx

### 线性定常系统综合
#### 线性反馈系统分类
1. 状态反馈：将系统的每一个状态变量乘以反馈系数，反馈到输入端与参考输入相加形成控制律，作为控制输入。如u = Kx + v，则x' = (A + BK)x + Bv。
2. 输出反馈：采用输出矢量y构成线性反馈律，即u = Hy + v = H(Cx + Du) + v，x' = (A + BHC)x + bv
3. 从输出到状态矢量x'的反馈

#### 能控标准1型
若线性定常单输入系统能控，则存在线性非奇异变换x = T~cl~x^-^，T~cl~ = (A^n-1^b, A^n-2^b, ..., Ab, b)[1, a~n-1~ 1, ..., a~2~ a~3~ ... 1, a~1~ ... 1]，使x^-^' = A^-^x^-^ + b^-^u，y = c^-^x^-^。
其中A^-^ = T~cl~^-1^AT~cl~，b^-^ = T~cl~^-1^b，c^-^ = cT~cl~

#### 极点配置问题
1. 判断是否能控，写成能控标准I型
2. 加入状态反馈矩阵K，写出特征多项式f = det[λI - (A + bK)]
3. 根据给定极点值计算期望特征多项式
4. 比较系数

#### 其它问题
1. 系统镇定问题：对受控系统通过反馈使其极点均具有负实部，保证系统渐进稳定。
2. 系统解耦问题：使输入输出相互关联的多变量系统实现每个输出仅受一个输入控制的系统
方法：
* 前馈补偿器解耦，在待解耦系统前串联前馈补偿器，使串联组合系统的传递函数矩阵为对角有理函数矩阵
* 状态反馈解耦，设计状态反馈矩阵K和奇异变换矩阵F，使v到y解耦。
定义d~i~是满足c~i~A^l^B ≠ 0的最小整数l，c~i~为C中第i行向量。记D=[c~1~A^d1^ ... c~m~A^dm^]，E = DB，L = DA，能解耦的充要条件是E非奇异。
积分型解耦系统，x' = (A + BK)x + BFx，其中K = -E^-1^L，F = E^-1^，W(s) = C[sI - (A + BK)]^-1^BF = [s^1/d1+1^ ... s^1/dm+1^]。

### 最优控制
#### 基本概念
1. 泛函：如果一个因变量，它的宗量不是独立自变量，而是另一些独立自变量的函数，则称该因变量为宗量函数的泛函。
2. 变分法：泛函的增量可表示为ΔJ = J[y(x) + δy(x)] - J[y(x)] = L[y(x), δy(x)] + R[y(x), δy(x)]，L为线性连续泛函，为泛函的变分，δy(x)为y(x)的变分。若可微泛函J[y(x)]在y~0~(x)达到极值，则y = y~0~上变分为0。使性能泛函J = ∫L(x,x',t)dt取极值的必要条件是dL/dx - d(dL/dx')/dt = 0。展开得L~x~ - L~tx'~ - L~xx'~dx/dt - F~x'x'~d^2^x/dt^2^  = 0。

#### 用变分法求连续系统最优控制问题
考虑系统x'(t) = f[x(t), u(t), t]，性能泛函J = ∫L[x(t), u(t), t]dt，寻求最优控制u。利用拉格朗日乘子法，将状态方程写成约束方程形式，得到J = ∫{L[x(t), u(t), t] + λ^T^(t)[f[x(t), u(t), t] - x'(t)]}dt = ∫{H[x,u,λ,t] - λ^T^x'}dt。记u(t)，x(t)变分为δu, δx，得到δJ = ∫[(δx)^T^(dH/dx + λ) + (δu)^T^dH/du]dt - (δx)^T^λ = 0，因此得到动态系统的伴随方程。
步骤：
1. 由dH/du = 0，解出u*
2. 将u* 代入正则方程求x*, λ*
3. 再代入u* = u[x*, y*] 

#### 波尔扎问题
考虑终端状态满足N[x(tf), tf] = 0，性能泛函J = Θ[x(tf), tf] + ∫L[x(t), u(t), t]dt，构造J = Θ[x(tf), tf] + μ^T^N[x(tf), tf] + ∫{L[x(t), u(t), t] + λ^T^(t)[f[x(t), u(t), t] - x'(t)]}dt。其中第一项和第二项的变分如图：

由此可得极值的必要条件dH/dx = -λ', dH/dλ = x'，dH/du = 0，终端时刻由H + dΘ/dtf + dN/dxμ = 0计算。

#### 极小值原理
当控制变量u(t)受到限制g[x(t),u(t),t] ≥ 0时，不适用变分法。引入新控制变量w(t)，令w'(t) = u(t)，w(t0) = 0，引入z(t)，令z'^2^ = g, z(t0) = 0。则转化为求J = Θ[x(tf), tf] + μ^T^N[x(tf), tf] + ∫{H[x(t), w'(t), λ, t] - λ^T^x' + γ[g - (z')^2^]}dt
极小值原理满足：
1. 正则方程x' = dH/dλ，λ' = -dH/dx - dg^T^/dxγ
2. 沿最优轨线，有dH/du = -dg^T^/duγ
3. 终点值[H + dΘ/dtf + μdN/dtf] = 0
4. 横截条件λ(tf) = [dΘ/dx(tf) + dN^T^/dx(tf)μ]
5. 满足边界条件

#### Bang-Bang控制
控制矢量的各个分量都取控制域边界值的控制，设x'(t) = Ax(t) + Bu(t)，可以求得最优控制u* = -SGN[B^T^λ] 

#### 动态规划
1. 离散系统，状态方程为x~k+1~ = f[x~k~, u~k~]，状态初值x(0) = x~0~，控制约束g[x~k~,u~k~] ≤ 0，性能泛函J = Θ[x~N~] + ΣL[x~k~, u~k~]。最优性能指标J~N~*[x~0~] = minJ~N~，只与x~0~有关。
对N段最优决策过程，应满足J~N~*[x~0~] = min{L[x~0~, u~0~] + J~N-1~ *[x~1~]}，由此可以得递推方程。

代码示例：(直升机从0m到10m，加速度小于2，最小时间)
```
clc; clear all; close all;
# 初始值
h_init = 0;
v_init = 0;
# 最终状态
h_final = 10;
v_final = 0;
# 边界条件
h_min = 0;
h_max = 10; N_h = 5
v_min = 0;
v_max = 3; N_v = 3;
# 状态数组
Hd = h_min : (h_max - v_min)/N_h : h_max;
Vd = v_min : (v_max - v_min)/N_v : v_max;
# 控制约束
u_min = -3, u_max = 2;
# 定义J矩阵
J_costtogo = zeros(N_h + 1, N_v + 1);
# 定义输入（加速度）矩阵
Input_acc = zeros(N_h + 1, N_v + 1);

## 递推计算(10到8m)
v_avg = 0.5 * (v_final + Vd);
T_delta = (h_max - h_min)./(N_h * v_avg);
acc = (0 - Vd)./T_delta;
J_temp = T_delta;
[acc_x, acc_y] = find(acc < u_min | acc > u_max);
# 利用sub2ind将多维数组的子索引转化为线性索引
Ind_lin_acc = sub2ind(size(acc), acc_N, acc_y);
J_temp(Ind_lin_acc) = inf;
J_costtogo(2,:) = J_temp;
Input_acc(2,:) = acc;

## 8m到6m
# V是一个4*4的矩阵
[Vd_x, Vd_y] = meshgrid(Vd, Vd);
V_avg = 0.5 * (Vd_x + Vd_y);
T_delta = (h_max - h_min)./(N_h * v_avg);
acc = (Vd_y - Vd_x)./T_delta;
J_temp = T_delta;
[acc_x, acc_y] = find(acc < u_min | acc > u_max);
Ind_lin_acc = sub2ind(size(acc), acc_N, acc_y);
J_temp(Ind_lin_acc) = inf;
# 把上一步的cost加到每一列里
# meshgrid(J_costtogo(2,:))每一列都是costtogo第二行的值
J_temp = J_temp + meshgrid(J_costtogo(2,:));
[J_costtogo(3,:),l] = min(J_temp);
Ind_lin_acc = sub2ind(size(J_temp), 1, 1:length(l));
Input_acc(3,:) = acc(Ind_lin_acc);
# 后续同理
```
对于连续系统方程x' = f[x,u,t]，性能泛函J = min{∫L[x,u,t]dt + Θ[x(t~f~)]}，则J*[x,t] = min{L[x,u,t]Δt + J*[x(t+Δt), t+Δt]}，泰勒展开得到J*[x(t+Δt), t+Δt] = J*[x,t] + [dJ*[x,t]/dx]^T^Δx + dJ*[x,t]/dtΔt。代入并整理可得贝尔曼方程：-dJ*/dt = min{L + [dJ*/dx]^T^f[x,u,t]}，可以记H = L + [dJ*/dx]^T^f[x,u,t]。

#### LQR最优控制
考虑泛函的一般形式J = 1/2∫[x^T^Q~1~x + u^T^Q~2~u]dt + 1/2x^T^(tf)Q~0~x(tf)，分别是状态加权，控制加权，终端加权矩阵。
1. 有限时间状态调节器
状态调节器寻求最优控制律u，在有限时间内将系统从初始状态转移到零点附近，并使J取极值。